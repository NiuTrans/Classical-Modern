◎律历十
○观天历
元祐《观天历》
演纪上元甲子，距元祐七年壬申，岁积五百九十四万四千八百八算。（上考往古，每年减一；下验将来，每年加二。）
步气朔
统法：一万二千三十。
岁周：四百三十九万三千八百八十。
岁余：六万三千八十。
气策：一十五、余二千六百二十八、秒一十一。
朔实：三十五万五千二百五十三。
朔策：二十九、余六千三百八十三。
望策：一十四、余九千二百六、秒一十八。
弦策：七、余四千六百三、秒九。
岁闰：一十三万八百四十四。
中盈分：五千二百五十六、秒二十四。
朔虚分：五千六百四十七。
没限分：九千四百二。
闰限：三十四万四千三百四十九、秒一十二。
旬周：七十二万一千八百。
纪法：六十。
以上秒母同三十六。
推天正冬至：置距所求积年，以岁周乘之，为气积分；满旬周去之，不尽，以统法约之为大余，不满为小余。其大余命甲子，算外，即所求年天正冬至日辰及余。
求次气：置天正冬至大、小余，以气策及余秒累加之，（秒盈秒法从小余一，小余盈统法从大余一，大余盈纪法去之。）命甲子，算外，即各得次气日辰及余秒。
推天正经朔：置天正冬至气积分，以朔实去之，不尽为闰余；以减天正冬至气积分，余为天正十一月经朔加时积分；满旬周去之，不尽，以统法约之为大余，不满为小余。其大余命甲子，算外，即所求年天正十一月经朔日辰及余。
求弦望及次朔经日：置天正十一月经朔大、小余，以弦策累加之，去命如前，即各得弦、望及次朔经日及余秒。
求没日：置有没之气小余，以三百六十乘之，其秒进一位，从之，用减岁周，余满岁余除之为日，不满为余。其日，命其气初日日辰，算外，即为其气没日日辰。（凡气小余在没限以上者，为有没之气。）
求灭日：置有灭之朔小余，以三十乘之，满朔虚分除之为日，不满为余。其日命其月经朔初日日辰，算外，即为其月灭日日辰。（凡经朔小余不满朔虚分者，为有灭之朔。）
步发敛
候策：五、余八百七十六、秒四。
卦策：六、余一千五十一、秒一十二。
土王策：三、余五百二十五、秒二十四。
月闰：一万九百三、秒二十四。
辰法：二千五。
半辰法：一千二半。
刻法：一千三百三。
秒母：三十六。
推七十二候：各因中节大、小余命之，为初候；以候策加之，为次候；又加之，为末候。
求六十四卦：各因中气大、小余命之，为初卦用事日；以卦策加之，为中卦用事日；又加之，得终卦用事日。以土王策加诸侯内卦，得十有二节之初外卦用事日；又加之，得大夫卦用事日；复以卦策加之，得卿卦用事日。
推五行用事：各因四立之节大、小余命之，即春木、夏火、秋金、冬水首用事日；以土王策减四季中气大、小余，命甲子，算外，为其月土始用事日。
求中气去经朔：置天正冬至闰余，以月闰累加之，满统法约之为日，不尽为余，即各得每月中气去经朔日及余秒。（其闰余满闰限者，为月内有闰也；仍定其朔内无中气者为闰月。）
求卦候去经朔：以卦、候策累加减中气，去经朔日及余，（中气前，减；中气后，加。）即各得卦、候去经朔日及余秒。
求发敛加时：倍所求小余，以辰法除之为辰数，不满，五因之，满刻法为刻，不满为余。其辰数命子正，算外，即各得所求加时辰、刻及分。
步日躔
周天分：四百三十九万四千三十四、秒五十七。
周天度：三百六十五、余三千八十四、秒五十七。
岁差：一百五十四、秒五十七。
二至限日：一百八十二、余七千四百八十。
冬至后盈初夏至后缩末限日：八十八、余一万九百五十八。
夏至后缩初冬至后盈末限日：九十三、余八千五百五十二。
求每日盈缩分：置入二至后全日，各在初限已下为初限；已上，用减二至限，余为末限。列初、末限日及分于上，倍初、末限日及约分于下，相减相乘。求盈缩分者，在盈初、缩末，以三千二百九十四除之。在盈末、缩初，以三千六百五十九除之，皆为度，不满，退除为分秒。求朏朒积者，各退二位，在盈初缩末，以三百六十六而一；在盈末缩初，以四百七而一，各得所求。以盈缩相减，余为升降分；（盈初缩末为升，缩初盈末为降。）以朏朒积相减，余为损益率。（在初为益，在末为损。）
求经朔弦望入盈缩限：置天正闰日及余，减缩末限日及余，为天正十一月经朔入缩末限日及余；以弦策累加之，满盈缩限日去之，即各得弦望及次朔入盈缩限日及余秒。
求经朔弦望朏朒定数：各置所入盈缩限日小余，以其日下损益率乘之，如统法而一，所得，损益其下朏朒积为定数。
求定气：冬夏二至以常气为定气。自后，以其气限日下盈缩分盈加缩减常气约余，即为所求之气定日及分秒。
赤道宿度
斗：二十六牛：八女：十二虚：十少（秒六十四）
危：十七室：十六壁：九
北方七宿九十八度少、秒六十四。
奎：十六娄：十二胃：十四昴：十一
毕：十七觜：一参：十
西方七宿八十一度。
井：三十三鬼：三柳：十五星：七
张：十八翼：十八轸：十七
南方七宿一百一十一度。
角：十二亢：九氐：十五。房：五
心：五尾：十八箕：十一
东方七宿七十五度。
前皆赤道宿度，与古不同。自《大衍历》依浑仪测为定，用纮带天中，仪极攸凭，以格黄道。
推天正冬至加时赤道日度：以岁差乘所求积年，满周天分去之，不尽，用减周天分，余以统法除之为度，不满为余。命起赤道虚宿四度外去之，至不满宿，即为所求年天正冬至加时赤道日度及余秒。
求夏至赤道日度：置天正冬至加时赤道日度，以二至限及余加之，满赤道宿次去之，即得夏至加时赤道日度及余秒。（因求后昏后夜半赤道日度者，以二至小余减统法，余以加二至赤道日度之余，即二至初日昏后夜半赤道日度，以每日累加一度，去命如前，各得所求。）
求二十八宿赤道积度：置二至加时日躔赤道全度，以二至加时赤道日度及约分减之，余为距后度。以赤道宿次累加之，即得二十八宿赤道积度及分秒。
求二十八宿赤道积度入初末限：各置赤道积度及分秒，满象限九十一度三十一分、秒九即去之，若在四十五度六十五分、秒五十四半已下为初限；已上，用减象限，余为末限。
求二十八宿黄道度：各置赤道宿入初、末限度及分，三之，为限分。用减四百，余以限分乘之，一万二千而一为度，命曰黄赤道差。至后以减、分后以加赤道宿积度，为黄道积度；以前宿黄道积度减之，余为二十八宿黄道度及分。（其分就近约为太、半、少，若二至之宿不足减者，即加二至限，然后减之，余依术算。）
黄道宿度
斗：二十三半牛：七半女：十一半虚：十少（秒六十四。）
危：十七太室：十七少壁：九太
北方七宿九十七度半、秒六十四。
奎：十七太娄：十二太胃：十四半昴：十一太
毕：十六觜：一参：九少
西方七宿八十二度。
井：三十鬼：二太柳：十四少星：七
张：十八太翼：十九半轸：十八太
南方七宿一百一十一度。
角：十三亢：九半氐：十五半房：五
心：四太尾：十七箕：十
东方七宿七十四度太。
前黄道宿度，乃依今历岁差变定。若上考往古，下验将来，当据岁差，每移一度，依历推变，然后可步七曜，知其所在。
求天正冬至加时黄道日度：置天正冬至加时赤道日度及约分，三之，为限分；用减四百，余以限分乘之，一万二千而一为度，命曰黄赤道差；用减天正冬至加时赤道日度及分，即为所求年天正冬至加时黄道日度及分。（夏至日度，准此求之。）
求二至初日晨前夜半黄道日度：置一万分，以其日升降分升加降减之，以乘二至小余，如统法而一，所得，以减二至加时黄道日度，余为二至初日晨前夜半黄道日度及分。
求每日晨前夜半黄道日度：置二至初日晨前夜半黄道日度及分，每日加一度，百约其日下升降分，升加降减之，满黄道宿次去之，即各得二至后每日晨前夜半黄道日度及分。
求太阳过宫日时刻：置黄道过宫宿度，以其日晨前夜半黄道宿度及分减之，余以统法乘之，如其太阳行分而一，为加时小余；如发敛求之，即得太阳过宫日、时、刻及分。
黄道过宫（太史局吴泽等补治有此一段，开封进士吴时举、国学进士程憙、常州百姓张文进本并无之。）
危宿十五度少，入卫之分，亥。奎宿三度半，入鲁之分，戌。
胃宿五度半，入赵之分，酉。毕宿十度半，入晋之分，申。
井宿十二度，入秦之分，未。柳宿七度半，入周之分，午。
张宿十七度少，入楚之分，巳。轸宿十二度，入郑之分，辰。
氐宿三度少，入宋之分，卯。尾宿八度，入燕之分，寅。
斗宿九度，入吴之分，丑。女宿六度少，入齐之分，子。
步月离
转周分：三十三万一千四百八十二、秒三百八十九。
转周日：二十七、余六千六百七十二、秒三百八十九。
朔差日：一、余一万一千七百四十、秒九千六百一十一。
弦策：七、余四千六百三、秒二千五百。
望策：一十四、余九千二百六、秒五千。
以上秒母同一万。
七日：初数一万六百九十，初约八十九；末数一千三百四十，末约一十一。
十四日：初数九千三百五十一，初约七十八；末数二千六百七十九，末约二十二。
二十一日：初数八千一十一，初约六十七；末数四千一十九，末约三十三。
二十八日：初数六千六百七十二，初约五十五。
上弦：九十一度三十一分、秒四十一。
望：一百八十二度六十二分、秒八十二。
下弦：二百七十三度九十四分、秒二十三。
平行：一十三度三十六分、秒八十七半。
以上秒母同一百。
求天正十一月经朔加时入转：置天正十一月经朔加时积分，以转周分秒去之，不尽，以统法约之为日，不满为余。命日，算外，即得所求年天正十一月经朔加时入转日及余秒。（若以朔差日及余秒加之，满转周日及余秒去之，即次朔加时入转日及余秒。各以其月经朔小余减之，余为其月经朔夜半入转。）
求弦望入转：因天正十一月经朔加时入转日及余秒，以弦策累加之，去命如前，即得弦、望入转日及余秒。求朔弦望入转朏朒定数：置入转余，乘其日算外损益率，如统法而一，所得，以损益其下朏朒积为定数。其在四七日下余如初数已下，初率乘之，初数而一，以损益其下朏朒积为定数。若初数已上者，以初数减之，余乘末率，末数而一，用减初率，余加其日下朏朒积为定数。（其十四日下余若在初数已上者，初数减之，余乘末率，末数而一，便为朏定数。）
求朔弦望定日、各以入限、入转朏朒定数，朏减朒加经朔、弦、望小余，满若不足，进退大余，命甲子，算外。各得定日及余。若定朔干名与后朔干名同者月大，不同者月小，其月内无中气者为闰月。（凡注历，观定朔小余，秋分后在统法四分之三已上者，进一日；若春分后定朔晨昏差如春分之日者，三约之，用减四分之三；定朔小余在此数已上者，亦进一日；或当交亏初在日入已前者，其朔不进。弦、望定小余不满日出分者，退一日；望若有交，亏初在日出分已前者，其定望小余虽满日出分，亦退一日。又有月行九道迟疾，历有三大二小者；依盈缩累增损之，则有四大三小，理数然也。若俯循常仪，当察加时早晚，随其所近而进退之，使不过三大二小。）
求定朔弦望加时日度：置定朔、弦、望约分，副之，以乘其日升降分，一万约之，所得，升加降减其副，以加其日夜半日度，命如前，各得定朔、弦、望加时日躔黄道宿度及分秒。
求月行九道：凡合朔初交，冬入阴历，夏入阳历，月行青道。（冬至、夏至后，青道半交在春分之宿，出黄道东；立冬、立夏后，青道半交在立春之宿，出黄道东南：至所冲之宿亦如之。）冬入阳历，夏入阴历，月行白道。（冬至、夏至后，白道半交在秋分之宿，出黄道西；立冬、立夏后，白道半交在立秋之宿，出黄道西北；至所冲之宿亦如之。）春入阳历，秋入阴历，月行朱道。（春分、秋分后，朱道半交在夏至之宿，出黄道南；立夏、立秋后，朱道半交在立夏之宿，出黄道西南：至所冲之宿亦如之。）春入阴历，秋入阳历，月行黑道。（春分、秋分后，黑道半交在冬至之宿，出黄道北；立春、立秋后，黑道半交在立冬之宿，出黄道东北：至所冲之宿亦如之。）四序离为八节，至阴阳之所交，皆与黄道相会，故月行有九道。各视月行所入正交积度，满交象去之，（入交积度及交象度，并在交会术中。）若在半交象已下为初限；已上，覆减交象，余为末限。置初、末限度及分，三之，为限分；用减四百，余以限分乘之，二万四千而一为度，命曰月道与黄道差数。距正交后、半交前，以差数加；距半交后、正交前，以差数减。（此加减出入黄道六度，单与黄道相校之数，若校赤道，则随气迁变不常。）仍计去冬、夏二至已来度数，乘差数，如九十而一，为月道与赤道差数。（凡日以赤道内为阴，外为阳；月以黄道内为阴，外为阳。故月行宿度，入春分交后行阴历，秋分交后行阳历，皆为同名；入春分交后行阳历，秋分交后行阴历，皆为异名。）其在同名者，以差数加者加之，减者减之；其在异名者，以差数加者减之，减者加之。二差皆增益黄道宿积度，为九道宿积度；以前宿九道积度减之，为其宿九道度及分秒。（其分就近约之为太、半、少。）
求月行九道平交入气：各以其月闰日及余，加经朔加时入交泛日及余秒，盈交终日及余秒去之，乃减交终日及余秒。即各得平交入其月中气日及余秒；若满气策即去之，余为平交入后月节气日及余秒。（若求朏朒定数，如求朔、望朏朒术入之，即得所求。）
求平交入转朏朒定数：置所入气余，加其日夜半入转余，乘其日算外损益率，如统法而一，所得，以损益其下朏朒积，乃以交率乘之，交数而一，为定数。
求正交入气：以平交入气、入转朏朒定数，朏减朒加平交入气余，满若不足，进退其日，即正交入气日及余秒。
求正交加时黄道日度：置正交入气余，副之，以乘其日升降分，一万约之，升加降减其副，乃以一百乘之，如统法而一，以加其日夜半日度，即正交加时黄道日度及分秒。
求正交加时月离九道宿度：置正交度加时黄道日及分，三之，为限分。用减四百，余以限分乘之，二万四千而一，命曰月道与黄道差数。以加黄道宿度，仍计去冬、夏二至已来度数，以乘差数，如九十而一，为月道与赤道差数。同名以加，异名以减，二差皆增损正交度，即正交加时月离九道宿度及分秒。
求定朔弦望加时月离黄道宿度：置定朔、弦、望加时日躔黄道宿度及分，凡合朔加时，月行潜在日下，与太阳同度，是为加时月度。各以弦、望度加其所当日度，满黄道宿次去之，即各得定朔、弦、望加时月离黄道宿度及分秒。
求定朔弦望加时月离九道宿度：置定朔、弦、望加时月离黄道宿度及分秒，加前宿正交后黄道积度，如前求九道术入之，以前定宿正交后九道积度减之，余为定朔、弦、望加时月离九道宿度及分秒。（凡合朔加时，若非正交，即日在黄道、月在九道所入宿度。虽多少不同，考其去极，若应绳准，故曰加时九道。）
求定朔午中入转：各视经朔夜半入转日及余秒，以半法加之，若定朔及余有进退者，亦进退转日，否则因经为定。（因求次日，累加一日，满转周日及余秒去之，即每日午中入转。）
求晨昏月度：以晨分乘其日算外转定分，如统法而一，为晨转分；用减转定分，余为昏转分；乃以朔、弦、望小余乘其日算外转定分，如统法而一，为加时分；以减晨昏转分，余为前；不足减者，覆减之，余为后；以前加后减定朔、弦、望月度，即晨、昏月所在度。
求朔弦望晨昏定程：各以其朔昏定月减上弦昏定月，余为朔后昏定程；以上弦昏定月减望昏定月，余为上弦后昏定程；以望晨定月减下弦晨定月，余为望后晨定程；以下弦晨定月减后朔晨定月，余为下弦后晨定程。
求每日转定度数：累计每程相距日转定分，以减定程，余为盈；不足减者，覆减之，余为缩；以相距日除之，所得，盈加缩减每日转定分，为每日转定度及分秒。
求每日晨昏月：置朔、弦、望晨昏月，以每日转定度及分加之，满宿次去之，为每日晨昏月。（凡注历，自朔日注昏月，望后一日注晨月。）已前月度并依九道所推，以究算术之精微，如求速要，即依后术求之。
求天正十一月经朔加时平行月：置岁周，以天正闰余减之，余以统法约之为度，不满，退除为分秒，即天正十一月经朔加时平行月积度及分秒。
求天正十一月定朔夜半平行月：置天正经朔小余，以平行月度分秒乘之，如统法而一为度，不满，退除为分秒，以减天正十一月经朔加时平行月积度，即天正十一月经朔晨前夜半平行月。其定朔大余有进退者，亦进退平行度，否则因经为定，即天正十一月定朔晨前夜半平行月积度及分秒。
求次定朔夜半平行月：置天正十一月定朔晨前夜半平行月积度及分秒，大月加三十五度八十分、秒六十一，小月加二十二度四十三分、秒七十三半，满周天度及约分、秒去之，即得次定朔晨前夜半平行月积度及分秒。
求弦望定日夜半平行月：各计朔、弦、望相距之日，乘平行度及分秒，以加其月定朔晨前夜半平行月积度及分秒，即其月弦望定日晨前夜半平行月积度及分秒。
求定朔晨前夜半入转：置其月经朔晨前夜半入转日及余秒，若定朔大余有进退者，亦进退转日，否则因经为定，其余如统法退除为分秒，即得其月定朔晨前夜半入转日及分秒。（因求次日，累加一日，满转周二十七日五十五分、秒四十六去之，即每日晨前夜半入转。）
求定朔弦望晨前夜半定月：置定朔、弦、望晨前夜半入转分，乘其日算外增减差，百约为分，分满百为度，增减其下迟疾度，为迟疾定度；迟减疾加定朔、弦、望晨前夜半平行月积度及分秒，以天正冬至加时黄道日度加而命之，即各得定朔、弦、望晨前夜半月离宿度及分秒。（如求每日晨、昏月，依前术入之，即得所求。）
步晷漏
二至限：一百八十二日六十二分。
一象：九十一日三十一分。
消息法：九千七百三。
半法：六千一十五。
辰法：二十五。
半辰法：一十二半。
刻法：一千二百二。
辰刻：八、余四百一。
昏明分：三百太。
昏明刻：二、余六百一半。
冬至岳台晷影常数：一丈二尺八寸五分。
夏至岳台晷影常数：一尺五寸七分。
冬至后初限夏至后末限：四十五日、六十二分。
冬至后末限夏至后初限：一百三十七日、空分。
求岳台晷影入二至后日数：计入二至以来日数，以二至约分减之，乃加半日之分五十，即入二至后来午中日数及分。
求岳台午中晷影定数：置入二至后日及分，如初限已下者为初；已上，覆减二至限，余为末。其在冬至后初限、夏至后末限者，以入限日入分减一千九百三十七半，为泛差。仍以入限日及分乘其日盈缩积，（其盈缩积者，以入盈缩限日及分与二百相减相乘，为盈缩积也。）五因百约，用减泛差，为定差；乃以入限日及分自相乘，以定差乘之，满一百万为尺，不满为寸、分，以减冬至岳台晷影常数，余为其日午中晷影定数。其在冬至后末限、夏至后初限者，以三约入限日及分，减四百八十五少，为泛差；仍以盈缩差度减去极度，余者春分后、秋分前，四约，以加泛差，为定差。春分前、秋分后，以去二分日数乘之，六百而一，以减泛差，为定差。乃以入限日及分自相乘，以定差乘之，满一百万为尺，不满为寸分，以加夏至岳台晷影常数，为其日午中晷影定数。
求每日午中定积日：置其日午中入二至后来日数及分，以其日盈缩分盈加缩减之，即每日午中定积日及分。
求每日午中消息定数：置定积日及分，在一象已下自相乘，已上，用减二至限，余亦自相乘，七因，进二位，以消息法除之，为消息常数；副置之，用减六百一半，余以乘其副，以二千六百七十除之，以加常数，为消息定数。（冬至后为息，夏至后为消。）
求每日黄道去极度：置其日消息定数，十六乘之，满四百一除之为度，不满，退除为分，春分后加六十七度三十一分，秋分后减一百一十五度三十一分，即每日午中黄道去极度及分。
求每日太阳去赤道内外度：置其日黄道去极度及分，与一象度相减，余为太阳去赤道内、外度及分。（去极多为日在赤道外，去极少为日在赤道内。）
求每日晨昏分及日出入分半昼分。置其日消息定数，春分后加二千一百少，秋分后减三千三百八少，各为其日晨分；用减统法，余为昏分。以昏明分加晨分，为日出分；减昏分，为日入分；以日出分减半法，余为半昼分。
求每日距中度：置其日晨分，进位，十四因之，以四千六百一十一除之为度，不满，退除为分，即距子度。用减半周天，余为距中度；五而一，为每更差数。
求每日夜半定漏：置晨分，进一位，如刻法而一为刻，不满为刻分，即每日夜半定漏。
求每日昼夜刻及日出入辰刻：置夜半定漏，倍之，加五刻，为夜刻。减百刻，为昼刻。以昏明刻加夜半定漏，命子正，算外，得日出辰刻。以昼刻加之，命如前，即日入辰刻。（其辰数依发敛术求之。）
求更点辰刻：置其日夜半定漏，倍之，二十五而一为筹差；半之，进位，为更差。以昏明刻加日入辰刻，即甲夜辰刻；以更筹差累加之，满辰刻及分去之，各得每更筹所在辰刻及分。（若用司辰漏者，倍夜半定漏，减去待旦十刻，余依术算，即得内中更筹也。）
求每日昏晓中星及五更中星：置距中度，以其日昏后夜半赤道日度加而命之，即得其日昏中星所格宿次，命之曰初更中星。以每更差度加而命之，即乙夜中星。以更差度累加之，去命如前，即五更及晓中星。（若依司辰星漏倍距子度，减去待旦三十六度五十二分半，余依术求更点差度，即内中昏晓五更及攒点中星也。）
求九服距差日：各于所在立表候之，若地在岳台北，测冬至后与岳台冬至晷影同者，累冬至后至其日，为距差日。若地在岳台南，测夏至后与岳台晷影同者，累夏至后至其日，为距差日。
求九服晷影：若地在岳台北冬至前后者，以冬至前后日数减距差日，为余日。以余日减一千九百三十七半，为泛差。依前术求之，以加岳台冬至晷影常数，为其地其日午中晷影定数。冬至前后日多于距差日者，乃减去距差日，余依法求之，即得其地其日午中晷影定数。若地在岳台南夏至前后者，以夏至前后日数减距差日，为余日。乃三约之，以减四百八十五少，为泛差。依前术求之，以减岳台夏至晷影常数，即其地其日午中晷影定数。如夏至前后日数多于距差日，乃减去距差日，余依法求之，即得其地其日午中晷影定数，即晷在表南也。
求九服所在昼夜漏刻：各于所在下水漏，以定二至夜刻，乃相减，余为二至差刻。乃置岳台其日消息定数，以其处二至差刻乘之，如岳台二至差刻二十除之，所得为其地其日消息定数。乃倍消息定数，进位，满刻法约之为刻，不满为分，以加减其处二至夜刻，（春分后、秋分前，以加夏至夜刻；秋分后、春分前，以减冬至夜刻。）为其地其日夜刻；以减百刻，余为昼刻。（求日出入差刻及五更中星，并依岳台法求之。）
